<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker Reset</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-slate-800 rounded-2xl p-6 space-y-4">
        <h1 class="text-2xl font-bold text-emerald-400">ğŸ”§ Service Worker Reset</h1>

        <div id="status" class="bg-slate-700 rounded-lg p-4 text-sm font-mono space-y-2">
            <div>â³ ÄŒekÃ¡m na akci...</div>
        </div>

        <button id="resetBtn"
            class="w-full py-4 bg-gradient-to-r from-red-500 to-orange-600 text-white rounded-xl font-bold text-lg active:scale-95 transition-all shadow-lg">
            ğŸ—‘ï¸ Vymazat vÅ¡e a restartovat
        </button>

        <button id="checkBtn"
            class="w-full py-3 bg-slate-700 text-white rounded-xl font-bold active:scale-95 transition-all">
            ğŸ” Zkontrolovat stav
        </button>

        <a href="/"
            class="block w-full py-3 bg-emerald-600 text-white rounded-xl font-bold text-center active:scale-95 transition-all">
            â† ZpÄ›t do aplikace
        </a>
    </div>

    <script>
        const statusDiv = document.getElementById('status');

        function log(message, isError = false) {
            const color = isError ? 'text-red-400' : 'text-emerald-400';
            statusDiv.innerHTML += `<div class="${color}">${message}</div>`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        function clearStatus() {
            statusDiv.innerHTML = '';
        }

        async function checkStatus() {
            clearStatus();
            log('ğŸ” Kontroluji Service Worker...');

            if (!('serviceWorker' in navigator)) {
                log('âŒ Service Worker nenÃ­ podporovÃ¡n', true);
                return;
            }

            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                log(`ğŸ“‹ Nalezeno registracÃ­: ${registrations.length}`);

                registrations.forEach((reg, i) => {
                    log(`\nğŸ“Œ Registrace #${i + 1}:`);
                    log(`  Scope: ${reg.scope}`);
                    log(`  Active: ${reg.active ? 'âœ… Ano' : 'âŒ Ne'}`);
                    log(`  Waiting: ${reg.waiting ? 'â¸ï¸ Ano' : 'âŒ Ne'}`);
                    log(`  Installing: ${reg.installing ? 'â³ Ano' : 'âŒ Ne'}`);
                });

                // Check caches
                const cacheNames = await caches.keys();
                log(`\nğŸ’¾ Nalezeno cachÃ­: ${cacheNames.length}`);
                cacheNames.forEach(name => log(`  - ${name}`));

            } catch (error) {
                log(`âŒ Chyba: ${error.message}`, true);
            }
        }

        async function resetAll() {
            clearStatus();
            log('ğŸ—‘ï¸ ZaÄÃ­nÃ¡m mazÃ¡nÃ­...\n');

            if (!('serviceWorker' in navigator)) {
                log('âŒ Service Worker nenÃ­ podporovÃ¡n', true);
                return;
            }

            try {
                // Unregister all service workers
                log('1ï¸âƒ£ MazÃ¡nÃ­ Service Worker registracÃ­...');
                const registrations = await navigator.serviceWorker.getRegistrations();

                if (registrations.length === 0) {
                    log('  â„¹ï¸ Å½Ã¡dnÃ© registrace nenalezeny');
                } else {
                    for (const reg of registrations) {
                        await reg.unregister();
                        log(`  âœ… OdregistrovÃ¡no: ${reg.scope}`);
                    }
                }

                // Clear all caches
                log('\n2ï¸âƒ£ MazÃ¡nÃ­ cache...');
                const cacheNames = await caches.keys();

                if (cacheNames.length === 0) {
                    log('  â„¹ï¸ Å½Ã¡dnÃ¡ cache nenalezena');
                } else {
                    for (const name of cacheNames) {
                        await caches.delete(name);
                        log(`  âœ… VymazÃ¡na: ${name}`);
                    }
                }

                // Clear localStorage
                log('\n3ï¸âƒ£ MazÃ¡nÃ­ localStorage...');
                const itemCount = localStorage.length;
                localStorage.clear();
                log(`  âœ… VymazÃ¡no ${itemCount} poloÅ¾ek`);

                log('\nâœ… HOTOVO! VÅ¡e vymazÃ¡no.');
                log('\nâš ï¸ DÅ®LEÅ½ITÃ‰: NynÃ­:');
                log('1. ZavÅ™ete vÅ¡echny taby s touto aplikacÃ­');
                log('2. PoÄkejte 2-3 sekundy');
                log('3. OtevÅ™ete aplikaci znovu');

                setTimeout(() => {
                    log('\nğŸ”„ Za 3 sekundy vÃ¡s pÅ™esmÄ›ruji...');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 3000);
                }, 2000);

            } catch (error) {
                log(`\nâŒ Chyba: ${error.message}`, true);
            }
        }

        document.getElementById('checkBtn').addEventListener('click', checkStatus);
        document.getElementById('resetBtn').addEventListener('click', resetAll);

        // Auto-check on load
        checkStatus();
    </script>
</body>

</html>